services:
  # Backend Service
  - type: web
    name: task4-backend
    runtime: docker
    repo: https://github.com/StartYourFork/Task4 # Optional, but good for context
    plan: free
    region: frankfurt # Optional
    # Context should be root so Dockerfile paths work naturally
    dockerContext: .
    dockerfilePath: ./backend/Dockerfile
    envVars:
      - key: ConnectionStrings__DefaultConnection
        fromDatabase:
          name: task4-db
          property: connectionString
      - key: App__FrontendUrl
        value: "*" # Allow any origin for simplicity in university task
      - key: Email__SmtpHost
        value: smtp.resend.com
      - key: Email__SmtpPort
        value: 587
      - key: Email__SmtpUser
        value: resend
      - key: Email__SmtpPass
        sync: false # User must enter this in dashboard
      - key: Email__FromAddress
        value: onlooking@resend.dev # Or your verified domain
      - key: ASPNETCORE_ENVIRONMENT
        value: Production

  # Frontend Service
  - type: web
    name: task4-frontend
    runtime: docker
    plan: free
    # Context root, Dockerfile in frontend
    dockerContext: .
    dockerfilePath: ./frontend/Dockerfile
    envVars:
      - key: VITE_API_URL
        sync: false # Must be updated manually after Backend is deployed

databases:
  - name: task4-db
    databaseName: task4
    user: task4user
    plan: free # Verification required for free tier, or stick to starter
